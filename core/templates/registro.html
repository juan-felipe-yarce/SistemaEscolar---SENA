{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block body_class %}no-aside{% endblock %}
{% block title %}Registro de Usuario{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/registro.css' %}">
{% endblock %}

{% block content %}
<div class="registro-container">
  <div class="registro-wrapper">
    <div class="registro-column">
      <div class="registro-card">
        <div class="registro-card-body">
          <div class="registro-header">
            <h2 class="registro-title">Registro de Usuario</h2>
            <a href="{% url 'login' %}" class="registro-btn-secondary">Volver a iniciar sesión</a>
          </div>

          {% if messages %}
            {% for message in messages %}
              <div class="registro-alert registro-alert-{{ message.tags }}">
                {{ message }}
                <button type="button" class="registro-btn-close" data-bs-dismiss="alert" aria-label="Cerrar">&times;</button>
              </div>
            {% endfor %}
          {% endif %}

          <form method="post" novalidate>
            {% csrf_token %}

            <div class="registro-field">
              <label for="id_correo" class="registro-label">Correo Electrónico:</label>
              {{ form.correo|add_class:"registro-input" }}
              {% if form.correo.errors %}
                <div class="registro-error">{{ form.correo.errors.0 }}</div>
              {% endif %}
            </div>

            <div class="registro-field">
              <label for="id_rol" class="registro-label">Rol:</label>
              {{ form.rol|add_class:"registro-select" }}
              {% if form.rol.errors %}
                <div class="registro-error">{{ form.rol.errors.0 }}</div>
              {% endif %}
            </div>

            <div id="coordinador-alerta" class="registro-alert registro-alert-warning registro-hidden">
              ⚠️ Tu cuenta será revisada por un Superusuario antes de poder ingresar. Recibirás una notificación cuando sea activada.
            </div>

            <div class="registro-field">
              <label for="id_tipo_documento" class="registro-label">Tipo de Documento:</label>
              {{ form.tipo_documento|add_class:"registro-select" }}
              {% if form.tipo_documento.errors %}
                <div class="registro-error">{{ form.tipo_documento.errors.0 }}</div>
              {% endif %}
            </div>

            <div class="registro-field">
              <label for="id_numero_documento" class="registro-label">Número de Documento:</label>
              {{ form.numero_documento|add_class:"registro-input" }}
              {% if form.numero_documento.errors %}
                <div class="registro-error">{{ form.numero_documento.errors.0 }}</div>
              {% endif %}
            </div>

            <div class="registro-field">
              <label for="id_pais_identificacion" class="registro-label">País de Expedición:</label>
              {{ form.pais_identificacion|add_class:"registro-select" }}
              {% if form.pais_identificacion.errors %}
                <div class="registro-error">{{ form.pais_identificacion.errors.0 }}</div>
              {% endif %}
            </div>

            <div class="registro-field">
              <label for="id_departamento_identificacion" class="registro-label">Departamento de Expedición:</label>
              {{ form.departamento_identificacion|add_class:"registro-select" }}
              {% if form.departamento_identificacion.errors %}
                <div class="registro-error">{{ form.departamento_identificacion.errors.0 }}</div>
              {% endif %}
            </div>

            <div class="registro-field">
              <label for="id_municipio_identificacion" class="registro-label">Municipio de Expedición:</label>
              {{ form.municipio_identificacion|add_class:"registro-select" }}
              {% if form.municipio_identificacion.errors %}
                <div class="registro-error">{{ form.municipio_identificacion.errors.0 }}</div>
              {% endif %}
            </div>

            <div class="registro-password-field">
              <label for="id_password" class="registro-label">Contraseña:</label>
              <div class="registro-input-wrapper">
                {{ form.password|add_class:"registro-input registro-password-input" }}
                <button type="button"
                        onclick="togglePasswordIcon('id_password', this)"
                        class="registro-password-toggle"
                        tabindex="-1">
                  <i class="bi bi-eye-slash"></i>
                </button>
              </div>
              {% if form.password.errors %}
                <div class="registro-error">{{ form.password.errors.0 }}</div>
              {% endif %}

              <div class="registro-progress">
                <div id="password-strength" class="registro-progress-bar"></div>
              </div>

              <ul class="registro-requirements" id="password-requirements">
                <li id="len" class="registro-requirement-danger">✔️ Al menos 8 caracteres</li>
                <li id="mayus" class="registro-requirement-danger">✔️ Una letra mayúscula</li>
                <li id="minus" class="registro-requirement-danger">✔️ Una letra minúscula</li>
                <li id="num" class="registro-requirement-danger">✔️ Un número</li>
                <li id="sym" class="registro-requirement-danger">✔️ Un símbolo especial (# $ % ! _)</li>
              </ul>
            </div>

            <div class="registro-password-field">
              <label for="id_confirmar_password" class="registro-label">Confirmar Contraseña:</label>
              <div class="registro-input-wrapper">
                {{ form.confirmar_password|add_class:"registro-input registro-password-input" }}
                <button type="button"
                        onclick="togglePasswordIcon('id_confirmar_password', this)"
                        class="registro-password-toggle"
                        tabindex="-1">
                  <i class="bi bi-eye-slash"></i>
                </button>
              </div>
              {% if form.confirmar_password.errors %}
                <div class="registro-error">{{ form.confirmar_password.errors.0 }}</div>
              {% endif %}
            </div>

            <div class="registro-submit-wrapper">
              <button type="submit" class="registro-btn-primary">Registrarse</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/registro.js' %}"></script>
{% endblock %}
